<!-- Contenedor principal dentro del header -->
<div class="flex justify-between items-center p-2 mx-2">
  <!-- Botón para cerrar el sidebar y párrafo Dashboard -->
  <div class="flex">
    @if (isAuthenticated && user?.emailVerified) {
    <button (click)="onToggleSidebar()" class="px-2">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="currentColor"
        class="w-6 h-6 text-gray-500 dark:text-gray-100"
        viewBox="0 0 16 16"
      >
        <path
          fill-rule="evenodd"
          d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"
        />
      </svg>
    </button>
    }
    <a
      routerLink="tool-panel"
      class="text-base font-medium ml-2 text-gray-500 dark:text-gray-100 hidden md:block"
      >Dashboard</a
    >
  </div>

  <!-- Filtro Busqueda -->
  <div class="flex h-8 w-full ml-2 mr-24 md:mr-0 md:ml-0 md:w-1/3 text-sm md:text-base rounded-full border-gray-400 dark:border-gray-100 border-opacity-65 border bg-gray-50 dark:bg-gray-800 px-2">
    <!-- Cambio (input)-->
    <input type="text" (input)="onSearch($event)" class="flex w-full bg-transparent px-3 text-gray-700 dark:text-gray-100 outline-0 font-sans" placeholder="Buscar" />
    <!-- Linea divisoria busqueda -->
    <div class="border-gray-400 dark:border-gray-s100 border-opacity-70 my-1 border-l"></div>
    <!-- Botón con icono de lupa -->
    <button
      type="submit"
      class="relative rounded-full bg-transparent px-1 dark:text-gray-100"
    >
      <svg
        class="fill-none size-4 md:size-5 dark:text-gray-100"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g
          id="SVGRepo_tracerCarrier"
          stroke-linecap="round"
          stroke-linejoin="round"
        ></g>
        <g id="SVGRepo_iconCarrier">
          <path
            d="M14.9536 14.9458L21 21M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z"
            stroke="#999"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </g>
      </svg>
    </button>
  </div>

  <!-- Icono usuario -->
  <div id="user" class="p-3">
    <button (click)="handleUserAction()">
      <div *ngIf="!isAuthenticated || !user?.emailVerified; else userProfile">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          class="w-6 h-6 text-gray-500 dark:text-gray-100"
          viewBox="0 0 16 16"
        >
          <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
          <path
            fill-rule="evenodd"
            d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"
          />
        </svg>
      </div>
      <ng-template #userProfile>
        <div *ngIf="user?.photoURL; else showInitial" class="flex items-center justify-center object-cover overflow-hidden w-6 h-6 rounded-full" >
          <img [src]="user?.photoURL" alt="Profile Photo" />
        </div>
        <ng-template #showInitial>
          <div class="bg-emerald-600 text-white text-sm font-sans rounded-full  items-center w-6 h-6 overflow-hidden ">
            {{userInitial}}
          </div>
        </ng-template>
      </ng-template>
    </button>

    <!-- Mostrar el dropdown si está autenticado -->
    <!-- [ngClass] se usa para agregar o quitar clases CSS condicionalmente basándose en una expresión booleana. -->
    @if(isAuthenticated && user?.emailVerified) {
    <div
      #dropdownMenu
      [ngClass]="{
        'transition ease-out duration-300 transform opacity-100 scale-100':
          isDropdownUserOpen,
        'transition ease-in duration-75 transform opacity-0 scale-95 pointer-events-none':
          !isDropdownUserOpen
      }"
      class="absolute right-0 mt-4 w-36 rounded-sm font-medium text-gray-600 dark:text-gray-100 bg-gray-50 dark:bg-gray-800 dark:border-none border-gray-200 border shadow-md z-20"
    >
      <a
        routerLink="/home/user/profile"
        class="flex justify-start items-center p-3 hover:bg-emerald-100 dark:hover:bg-gray-700"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          class="size-5"
          viewBox="0 0 16 16"
        >
          <path
            d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"
          />
        </svg>
        <label class="ml-2 cursor-pointer">Perfil</label>
      </a>

      <a
        (click)="userLogOut()"
        class="flex justify-start p-3 hover:bg-emerald-100 dark:hover:bg-gray-700"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          class="size-5"
          viewBox="0 0 16 16"
        >
          <path
            fill-rule="evenodd"
            d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"
          />
          <path
            fill-rule="evenodd"
            d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"
          />
        </svg>
        <label class="ml-3 cursor-pointer">Salir</label>
      </a>
    </div>
    }
  </div>
</div>
