<!-- FilterComponent-->
<app-filters 
  (filterChange)="onFilterChange($event)" 
  (subcategoryFilterChange)="onSubcategoryFilterChange($event)">
</app-filters>

<!-- Si filteredTools está vacío, muestra un mensaje de "No se encontraron resultados" -->
@if ((filteredTools | async)?.length === 0) {
  <div class="h-full flex items-start justify-center text-gray-400 dark:text-gray-300 mt-20">
    <h2 class="text-base md:text-lg font-medium">
      No se encontraron resultados para los filtros seleccionados
    </h2>
  </div>
}

<!-- Si el usuario es administrador, muestra el botón de "Nuevo" -->
@if (isAdmin) {
  <div class="">
    <button
      class="w-32 h-10 mt-[-20px] mb-6 flex items-center justify-center text-gray-500 rounded-lg font-medium border border-bg-gray-500 shadow-sm hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-900"
      (click)="openCreateModal()">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="size-5" viewBox="0 0 16 16" stroke="currentColor" stroke-width="1">
        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
      </svg>
    Nuevo
    </button>
  </div>
}

<!-- Contenido del ToolPanel -->
<div class="tool-container">
  <!-- Si hay resultados, muestra las herramientas filtradas -->
  <div *ngFor="let tool of filteredTools | async"
    class="w-full relative flex justify-between items-start shadow rounded-md border p-3 bg-gray-50 border-bg-gray-200 text-gray-900 hover:border-2 hover:border-emerald-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100 dark:hover:border-2 dark:hover:border-emerald-500"
    (click)="onToolSelected(tool)">

  <!-- Si el usuario es administrador saldrá el botón de editar y borrar -->
  @if (isAdmin) {
    <div class="text-gray-500 dark:text-gray-200 space-x-2 absolute bottom-3 right-3">

      <!-- Editar -->
      <button class="border shadow-sm border-gray-200 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700"
      (click)="openModifyModal(tool); $event.stopPropagation()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-4 h-4" viewBox="0 0 16 16">
          <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325" />
        </svg>
      </button>

      <!-- Borrar -->
      <button class="border shadow-sm border-gray-200 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700"
      (click)="openDeleteModal(tool); $event.stopPropagation()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-4 h-4" viewBox="0 0 16 16">
          <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5" />
        </svg>
      </button>
    </div>
  }

    <div class="relative w-full pl-2">

      @if(isAuthenticated$ | async) {
      <!-- Estrellita -->
      <div class="absolute flex items-center justify-center w-8 h-8 hover:bg-gray-200 hover:rounded-full dark:hover:bg-gray-700 text-gray-500 right-0 top-0">
        <button (click)="clickStar(tool.id); $event.stopPropagation()"
        class="ripple-button relative inline-flex items-center justify-center p-2 text-gray-500 dark:text-gray-300 rounded-full focus:outline-none overflow-hidden">
          <svg 
          [ngClass]="{'text-amber-500 && dark:text-amber-300': tool.isFavorite}"
          xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="size-4" viewBox="0 0 16 16">
          @if(!tool.isFavorite) {
            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z" />
          } @else { 
            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
          }
          </svg>
        </button>
      </div>
    }

      <!-- Logo -->
      <div class="w-6 h-6 my-4 text-gray-500 dark:text-gray-300">
        <!-- Si la URL de la imagen está disponible, muestra la imagen; si no, muestra un icono por defecto -->
         @if(tool.logo) {
          <img [src]="tool.logo" alt="{{ tool.name }}" class="w-6 h-6">
          } @else {
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-box" viewBox="0 0 16 16">
            <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z" />
          </svg>
          }   
      </div>
      
      <!-- Nombre y detalle de la aplicación -->
      <div class="mr-4">
        <h2 class="font-bold"> {{ tool.name }} </h2>
        <p class="text-gray-500 text-sm dark:text-gray-300"> {{ tool.detail }} </p>
        <small class="font-medium text-emerald-500">
          {{ tool.price === 0 ? 'Gratis' : tool.price + '€ mes' }}
        </small>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
@if (showModal) {
  @if (modalType === 'detail') {
    <app-tool-detail [toolData]="selectedTool" (closeModal)="closeModal()"></app-tool-detail>
  }
  @if (modalType === 'create') {
    <app-create (closeModal)="closeModal()"></app-create>
  }
  @if (modalType === 'modify') {
    <app-modify (closeModal)="closeModal()"></app-modify>
  }
  @if (modalType === 'delete') {
    <app-delete 
      [toolData]="selectedTool"
      (closeModal)="closeModal()"
      (confirmDelete)="deleteTool()"> <!-- Llama a deleteTool cuando el evento se dispare -->
    </app-delete>
  }
}